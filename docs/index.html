<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Søgning</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <input type="text" id="searchInput" placeholder="Søg efter podcasts...">
    <div id="results"></div>
</div>


<script>
    searchInput.addEventListener('input', async function() {
        const searchText = this.value.toLowerCase();
        const filteredPodcasts = await filterPodcasts(searchText);
        displayResults(filteredPodcasts);
    });
async function filterPodcasts(searchText) {
    const filteredPodcasts = [];

    const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZÆØÅ';
    for (const letter of alphabet) {
        const folderUrl = `https://api.github.com/repos/UmFzbXVz/podcasts/contents/${letter}?ref=main`;
        const rssFiles = await fetchPodcastsFromFolder(folderUrl);
        for (const rssFile of rssFiles) {
            const podcastUrl = rssFile.download_url;
            const response = await fetch(podcastUrl);
            const rssContent = await response.text();
            if (rssContent.toLowerCase().includes(searchText)) {
                filteredPodcasts.push(rssFile.html_url);
            }
        }
    }

    // Håndter mappe "0-9"
    const digitFolderUrl = `https://api.github.com/repos/UmFzbXVz/podcasts/contents/0-9?ref=main`;
    const digitRssFiles = await fetchPodcastsFromFolder(digitFolderUrl);
    for (const rssFile of digitRssFiles) {
        const podcastUrl = rssFile.download_url;
        const response = await fetch(podcastUrl);
        const rssContent = await response.text();
        if (rssContent.toLowerCase().includes(searchText)) {
            filteredPodcasts.push(rssFile.html_url);
        }
    }

    return filteredPodcasts;
}


    async function fetchPodcastsFromFolder(folderUrl) {
        const folderContents = await fetch(folderUrl);
        const folderContentsJson = await folderContents.json();
        const rssFiles = folderContentsJson.filter(file => file.name.endsWith('.rss'));
        return rssFiles;
    }

    function displayResults(results) {
        resultsContainer.innerHTML = '';
        if (results.length === 0) {
            resultsContainer.innerHTML = '<p>Ingen resultater fundet</p>';
            return;
        }
        const ul = document.createElement('ul');
        results.forEach(result => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = result;
            a.textContent = result;
            li.appendChild(a);
            ul.appendChild(li);
        });
        resultsContainer.appendChild(ul);
    }

    window.addEventListener('DOMContentLoaded', async () => {
        const allPodcasts = await filterPodcasts('');
        displayResults(allPodcasts);
    });
</script>


</body>
</html>
